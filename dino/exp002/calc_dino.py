import pandas as pd
from sklearn.metrics import roc_auc_score,accuracy_score,f1_score
import sklearn.metrics as metrics
import numpy as np
root ="/home/abe/kuma-ssl/ibot/exp000_e320_8cls/finetune/1per/2000/10"

import timm,glob


df = pd.read_csv("/home/abe/kuma-ssl/data/folds8.csv")
test_df = pd.read_csv("/home/abe/kuma-ssl/data/test8.csv")


print(df.columns)

#roots = glob.glob("/home/abe/kuma-ssl/dino/imnetViTS/1per/*/sub*csv")+glob.glob("/home/abe/kuma-ssl/dino/imnetViTS/10per/*/sub*csv")+glob.glob("/home/abe/kuma-ssl/dino/imnetViTS/all/sub*csv")
#roots = roots+glob.glob("/home/abe/kuma-ssl/dino/exp002/10per8/*/sub*csv")+glob.glob("/home/abe/kuma-ssl/dino/exp002/1per8/*/sub*csv")+glob.glob("/home/abe/kuma-ssl/dino/exp002/all8/*sub.csv")
#roots = glob.glob("/home/abe/kuma-ssl/dino/imnetViTS/10per/*/sub*csv")

#roots = roots+glob.glob("/home/abe/kuma-ssl/dino/exp002/finetune8/1per/*//*/sub*csv")+glob.glob("/home/abe/kuma-ssl/dino/exp002/finetune8/10per/*//*/sub*csv")+glob.glob("/home/abe/kuma-ssl/dino/exp002/finetune8/all//*/sub*csv")

#roots = glob.glob("/home/abe/kuma-ssl/ibot/exp000_e320_8cls/1per/*/sub*csv")+glob.glob("/home/abe/kuma-ssl/ibot/exp000_e320_8cls/10per/*/sub*csv")+glob.glob("/home/abe/kuma-ssl/ibot/exp000_e320_8cls/all/sub*csv")
roots = glob.glob("/home/abe/kuma-ssl/ibot/exp000_e320_8cls/finetune/1per/*//*/sub*csv")+glob.glob("/home/abe/kuma-ssl/ibot/exp000_e320_8cls/finetune/10per/*//*/sub*csv")+glob.glob("/home/abe/kuma-ssl/ibot/exp000_e320_8cls/finetune/all//*/sub*csv")



for root in roots[::-1]:
    folds  = []
    subs = []
    #if "1000" in root or "2022" in root or "2000" in root:continue



    sub = pd.read_csv(root)
    cols = [f"pred_{i}" for i in range(8)]
    subs_mean = sub[cols].to_numpy()
    

    def get_score(gt,preds):
        one_hot_label = np.eye(8)[gt.astype(np.int64)]
        pr_auc = 0
        each = []
        for i in range(8):
            label_ = one_hot_label[:,i]
            pred_ = preds[:,i]
            precision, recall, thresholds = metrics.precision_recall_curve(label_, pred_)
            pr_auc += metrics.auc(recall, precision)/8
            each.append(metrics.auc(recall, precision))
        th_pred = np.argmax(preds,axis=1)
        acc = accuracy_score(gt,th_pred)
        F1 = f1_score(gt,th_pred,average="macro")

        return pr_auc,acc,F1,"pruac,acc,f1"#,each
    print("_".join(root.split("/")[4:-1]))
    #print(get_score(folds["label"].to_numpy(),folds[cols].to_numpy()))
    print(get_score(sub["label"].to_numpy(),subs_mean))




"""

dino_exp002_all8
(0.9500051181521288, 0.8988950703137073, 0.8841636058219551, 'pruac,acc,f1')
dino_exp002_1per8_3000
(0.8993449980470518, 0.8503708854891052, 0.8088892644035035, 'pruac,acc,f1')
dino_exp002_1per8_1002
(0.873801521136644, 0.8447303353422964, 0.7795536643249337, 'pruac,acc,f1')
dino_exp002_1per8_1000
(0.8859918204853762, 0.8418714263637769, 0.794736521075017, 'pruac,acc,f1')
dino_exp002_1per8_2000
(0.8782004682051749, 0.8447689692474115, 0.7895225110521836, 'pruac,acc,f1')
dino_exp002_1per8_2022
(0.8948168125973723, 0.8458893524957503, 0.7953368518716848, 'pruac,acc,f1')
dino_exp002_10per8_3000
(0.9324748214845592, 0.8849095966620306, 0.8586619034697063, 'pruac,acc,f1')
dino_exp002_10per8_1002
(0.9341622250045812, 0.8812393756760933, 0.8632163191137519, 'pruac,acc,f1')
dino_exp002_10per8_1000
(0.9311991512749471, 0.8810462061505177, 0.8559466809114537, 'pruac,acc,f1')
dino_exp002_10per8_2000
(0.9354300067774082, 0.8851414000927214, 0.8625745066513908, 'pruac,acc,f1')
dino_exp002_10per8_2022
(0.927286360407413, 0.8791145108947612, 0.8496209961908179, 'pruac,acc,f1')
dino_imnetViTS_all
(0.9302450372269316, 0.8977360531602534, 0.8601656051480571, 'pruac,acc,f1')
dino_imnetViTS_1per_1002
(0.6983538669977025, 0.770050996754752, 0.6475532971772476, 'pruac,acc,f1')
dino_imnetViTS_1per_2000
(0.6853210623077248, 0.7675011590171534, 0.6401171654443508, 'pruac,acc,f1')
dino_imnetViTS_1per_2022
(0.7103280476150423, 0.7706305053314789, 0.6574676788183069, 'pruac,acc,f1')
dino_imnetViTS_1per_1000
(0.7122684929814305, 0.7727940040179261, 0.6620054569052165, 'pruac,acc,f1')
dino_imnetViTS_1per_3000
(0.7260112863093346, 0.7774687065368567, 0.6751766929864548, 'pruac,acc,f1')
dino_imnetViTS_1per_1002
(0.6983538669977025, 0.770050996754752, 0.6475532971772476, 'pruac,acc,f1')
dino_imnetViTS_1per_2000
(0.6853210623077248, 0.7675011590171534, 0.6401171654443508, 'pruac,acc,f1')
dino_imnetViTS_1per_2022
(0.7103280476150423, 0.7706305053314789, 0.6574676788183069, 'pruac,acc,f1')
dino_imnetViTS_1per_1000
(0.7122684929814305, 0.7727940040179261, 0.6620054569052165, 'pruac,acc,f1')
dino_imnetViTS_1per_3000
(0.7260112863093346, 0.7774687065368567, 0.6751766929864548, 'pruac,acc,f1')

ino_exp002_finetune8_all_0
(0.9557591018620737, 0.9097511976510586, 0.8920819470121387, 'pruac,acc,f1')
dino_exp002_finetune8_all_9
(0.9632785406180983, 0.9156235512285582, 0.9024432432225372, 'pruac,acc,f1')
dino_exp002_finetune8_all_10
(0.9613635471810094, 0.9145804357904497, 0.9007443292937283, 'pruac,acc,f1')
dino_exp002_finetune8_all_11
(0.9640282250366696, 0.9167053005717818, 0.9034782690542016, 'pruac,acc,f1')
dino_exp002_finetune8_10per_1002_9
(0.9457004302772309, 0.8969247411528357, 0.88044596974888, 'pruac,acc,f1')
dino_exp002_finetune8_10per_1002_10
(0.9465026214957782, 0.9003245248029671, 0.8832953072527389, 'pruac,acc,f1')
dino_exp002_finetune8_10per_1002_11
(0.9501915161915858, 0.9033379694019471, 0.8867248396667323, 'pruac,acc,f1')
dino_exp002_finetune8_10per_2022_9
(0.948805614456336, 0.9007881316643487, 0.8839341476648555, 'pruac,acc,f1')
dino_exp002_finetune8_10per_2022_10
(0.950375354357853, 0.9049605934167826, 0.8863762576442619, 'pruac,acc,f1')
dino_exp002_finetune8_10per_2022_11
(0.9542858565297998, 0.9072013599134601, 0.8915494765736245, 'pruac,acc,f1')
dino_exp002_finetune8_10per_2000_9
(0.9499361444656058, 0.9018698810075723, 0.8857517130548378, 'pruac,acc,f1')
dino_exp002_finetune8_10per_2000_10
(0.9500718363291653, 0.90268119301499, 0.8853433506491941, 'pruac,acc,f1')
dino_exp002_finetune8_10per_2000_11
(0.9544563122216654, 0.905965074949776, 0.8911964882934683, 'pruac,acc,f1')
dino_exp002_finetune8_10per_1000_9
(0.9465216175203893, 0.9010199350950394, 0.8838783092785903, 'pruac,acc,f1')
dino_exp002_finetune8_10per_1000_10
(0.9451333446923831, 0.9004404265183125, 0.878374490074359, 'pruac,acc,f1')
dino_exp002_finetune8_10per_1000_11
(0.9516835401958983, 0.9047287899860917, 0.8873855857749834, 'pruac,acc,f1')
dino_exp002_finetune8_10per_3000_9
(0.9451986621777551, 0.8964225003863391, 0.878060552100594, 'pruac,acc,f1')
dino_exp002_finetune8_10per_3000_10
(0.9488960680370266, 0.9028357286354505, 0.8845221848688076, 'pruac,acc,f1')
dino_exp002_finetune8_10per_3000_11
(0.9521614319235542, 0.90268119301499, 0.8856767723668091, 'pruac,acc,f1')
dino_exp002_finetune8_1per_1002_9
(0.8639766413563003, 0.8405965074949776, 0.782153344666784, 'pruac,acc,f1')
dino_exp002_finetune8_1per_1002_10
(0.8676344492848602, 0.8438803894297635, 0.7824915101661087, 'pruac,acc,f1')
dino_exp002_finetune8_1per_1002_11
(0.8729299716917671, 0.8445371658167208, 0.7875170417079254, 'pruac,acc,f1')
dino_exp002_finetune8_1per_2022_9
(0.8850347997894619, 0.8469324679338588, 0.7995060929206884, 'pruac,acc,f1')
dino_exp002_finetune8_1per_2022_10
(0.893333917997871, 0.8515299026425591, 0.8054479081852368, 'pruac,acc,f1')
dino_exp002_finetune8_1per_2022_11
(0.8988046554658472, 0.853886570854582, 0.8138169834555485, 'pruac,acc,f1')
dino_exp002_finetune8_1per_2000_9
(0.8716686648261079, 0.8400942667284809, 0.7892295877710062, 'pruac,acc,f1')
dino_exp002_finetune8_1per_2000_10
(0.8719194663337644, 0.8434940503786122, 0.790532481949778, 'pruac,acc,f1')
dino_exp002_finetune8_1per_2000_11
(0.8764170871392385, 0.8455802812548292, 0.7967352565744836, 'pruac,acc,f1')
dino_exp002_finetune8_1per_3000_9
(0.8964803682996481, 0.8507185906351414, 0.8147737548050313, 'pruac,acc,f1')
dino_exp002_finetune8_1per_3000_10
(0.8991738202887317, 0.8550069541029207, 0.8191610269974345, 'pruac,acc,f1')
dino_exp002_finetune8_1per_3000_11
(0.9014880503814099, 0.8549296862926905, 0.8220708455175774, 'pruac,acc,f1')
dino_exp002_finetune8_1per_1000_10
(0.8857828363350118, 0.848477824138464, 0.8061298097985834, 'pruac,acc,f1')
dino_exp002_finetune8_1per_1000_11
(0.8902141754150386, 0.8480528511821975, 0.8081689218081377, 'pruac,acc,f1')
dino_exp002_finetune8_1per_1000_9
(0.8770133608201708, 0.8417941585535466, 0.797732260778588, 'pruac,acc,f1')
dino_imnetViTS_10per_3000
(0.8687715113582433, 0.8585226394683975, 0.8039543075190236, 'pruac,acc,f1')
dino_imnetViTS_10per_1002
(0.8684830188172261, 0.8587158089939732, 0.8015121906745908, 'pruac,acc,f1')
dino_imnetViTS_10per_2000
(0.8709951482354507, 0.8645881625714728, 0.8089398626798241, 'pruac,acc,f1')
dino_imnetViTS_10per_2022
(0.8466707332257672, 0.8504481532993355, 0.7880509981689922, 'pruac,acc,f1')
dino_imnetViTS_10per_1000
(0.8669358755357922, 0.8583294699428218, 0.7921073805017055, 'pruac,acc,f1')

ibot_exp000_e320_8cls_all
(0.9542306260657724, 0.8993973110802039, 0.8873766126692535, 'pruac,acc,f1')
ibot_exp000_e320_8cls_10per_3000
(0.9424151412921122, 0.8809303044351723, 0.8630646432598894, 'pruac,acc,f1')
ibot_exp000_e320_8cls_10per_1002
(0.9439895576810435, 0.8827460979755833, 0.8659735658598844, 'pruac,acc,f1')
ibot_exp000_e320_8cls_10per_1000
(0.9411580371550251, 0.8827074640704683, 0.8650825248660814, 'pruac,acc,f1')
ibot_exp000_e320_8cls_10per_2022
(0.9399734913818726, 0.8785736362231494, 0.8604948202206932, 'pruac,acc,f1')
ibot_exp000_e320_8cls_10per_2000
(0.9414309513070516, 0.8833256065523103, 0.8647060538100841, 'pruac,acc,f1')
ibot_exp000_e320_8cls_1per_2022
(0.9083501718724319, 0.84581208468552, 0.8097016002949249, 'pruac,acc,f1')
ibot_exp000_e320_8cls_1per_2000
(0.8856377109779927, 0.8372353577499614, 0.7956506480353418, 'pruac,acc,f1')
ibot_exp000_e320_8cls_1per_1000
(0.9012561722109523, 0.8419873280791222, 0.8102826213463177, 'pruac,acc,f1')
ibot_exp000_e320_8cls_1per_3000
(0.9022661171573195, 0.8410987482614742, 0.808161256754975, 'pruac,acc,f1')
ibot_exp000_e320_8cls_1per_1002
(0.8960671096216456, 0.8469711018389738, 0.8068984472366438, 'pruac,acc,f1')

ibot_exp000_e320_8cls_finetune_all_10
(0.9681280232401573, 0.9121851336733117, 0.9039560495994192, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_all_11
(0.9668921377396372, 0.911373821665894, 0.9025521418964979, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_all_9
(0.968445685360349, 0.9151213104620615, 0.9064753995608243, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_1002_10
(0.9508864716887346, 0.8966156699119147, 0.8819343288462493, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_1002_11
(0.9462148917644043, 0.8909364858599907, 0.8743840252349899, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_1002_9
(0.9534000670795164, 0.901483541956421, 0.8873828041918426, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_3000_9
(0.9539163906829401, 0.9014449080513058, 0.8862015365003757, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_3000_11
(0.9478811085871311, 0.8925591098748261, 0.8748302160878626, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_3000_10
(0.9521067997170246, 0.8978133209704837, 0.8824895569086763, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_1000_9
(0.9508392072661815, 0.9011358368103848, 0.8850041340981023, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_1000_10
(0.94834542406417, 0.895804357904497, 0.8788401174252779, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_1000_11
(0.9427248763548916, 0.8872662648740535, 0.8680891485676122, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_2022_11
(0.9440221805577058, 0.8874594343996292, 0.8669863201144498, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_2022_10
(0.9496659433388068, 0.8956498222840364, 0.8777106953544187, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_2022_9
(0.9516453921909437, 0.8992814093648586, 0.8812051036021447, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_2000_10
(0.9494741006581358, 0.895186215422655, 0.8787909315146283, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_2000_9
(0.9520925474526876, 0.9007108638541184, 0.8844938144852311, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_10per_2000_11
(0.9446573206324603, 0.8895842991809612, 0.8711237200807549, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_1002_9
(0.887433086531537, 0.8454257456343687, 0.8042731672947686, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_1002_10
(0.8865389689206248, 0.8420645958893525, 0.801305026150151, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_1002_11
(0.8835595478221469, 0.8380080358522639, 0.7959753716112525, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_3000_9
(0.8850293485133239, 0.8392829547210632, 0.802181999855061, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_3000_11
(0.8800832538947514, 0.831749343223613, 0.7940945375288655, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_3000_10
(0.8834387345126259, 0.8358445371658167, 0.799158092057496, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_2022_9
(0.8941642799420264, 0.8442667284809149, 0.8078463580300035, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_2022_10
(0.8928637335213575, 0.841021480451244, 0.8043454856056939, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_2022_11
(0.8899694369474104, 0.8375830628959975, 0.8000640305934555, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_2000_9
(0.8765968647920792, 0.8364240457425437, 0.7922493483560125, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_2000_10
(0.8753472142268258, 0.8336037706691393, 0.78941287490713, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_2000_11
(0.8722501747411369, 0.8310539329315407, 0.7858893217983207, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_1000_10
(0.8892000187567994, 0.8395920259619842, 0.8038143614561191, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_1000_9
(0.890588594637785, 0.8419486941740071, 0.8064932795838081, 'pruac,acc,f1')
ibot_exp000_e320_8cls_finetune_1per_1000_11
(0.8863192570464344, 0.8359604388811621, 0.798835806218741, 'pruac,acc,f1')


"""